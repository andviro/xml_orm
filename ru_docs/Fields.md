# Поля XML

## Определение полей

Все поля задаются с помощью классов-потомков `xml_orm.fields.SimpleField` и
`xml_orm.fields.ComplexField`. Для простых полей (наследующих от `SimpleField`)
необязательный параметр `tag` задает название соответствующего элемента или (с
префиксом `@`) -- атрибута. 

Текстовые поля не имеют имени элемента, при создании таких полей им передается
параметр `is_text`, равный `True`.  Корректно отрабатываются несколько
текстовых полей, при условии что два текстовых поля не идут друг за другом,
т.к. в этом случае нет способа отделить их друг от друга.

Класс `ComplexField` позволяет вводить в состав схемы элементы со
сложным содержимым, т.е., имеющие суб-элементы и атрибуты. Первый параметр
конструктора может быть либо строкой, либо классом, совместимым с
`xml_orm.core.Schema`, либо отсутствовать.

Если `cls` является классом, то сложное поле принимает
заданную в нем структуру.  В следующем примере одна из схем включается в состав
другой в качестве сложного элемента. Название элемента берется из
мета-параметра `root`.

    :::python
    from xml_orm.core import Schema
    from xml_orm.fields import *
    
    class File(Schema):
        id = SimpleField(u'@id')
        name = SimpleField(default=u'Текст элемента', is_text=True)
        
        class Meta:
            root = u'file'
            
    class Directory(Schema):
        files = ComplexField(File, minOccurs=0, maxOccurs='unbounded')
        
        class Meta:
            root = u'directory'
            
Если параметр `cls` имеет строковый тип, схема сложного элемента конструируется
на месте. При этом дополнительные параметры конструктора задают набор полей
схемы, а корневой элемент принимает имя, равное `cls`. В следующем примере
создается схема `Doc`, в которой схема для поля `chapter` создается при
объявлении класса.

    :::python
    class Doc(Schema):
        author = CharField('@author', max_length=100)
        chapter = ComplexField(
            'chapter',
            title=SimpleField('@title'),
            p=SimpleField('p', maxOccurs='unbounded'),
            minOccurs=0,
            maxOccurs='unbounded',)

        class Meta:
            root = 'doc'
            pretty_print = True

## Упрощенное определение схемы
            
При объявлении полей необязательно задавать для них имя элемента, а для
схемы - мета-параметр `root`. Для полей имя элемента по умолчанию берется из
названия поля в объявляемом классе, а для схемы - из названия самого класса.
Следующий пример делает то же, что и предыдущий, но без задания лишних
параметров.
    
    :::python
    class doc(Schema):
        author = CharField(max_length=100)
        chapter = ComplexField(
            minOccurs=0,
            maxOccurs='unbounded',
            
            title=SimpleField(),
            p=SimpleField(maxOccurs='unbounded', is_attribute=False),)

        class Meta:
            pretty_print = True

Простые поля, заданные без имени элемента, по умолчанию считаются атрибутами. В
предыдущем примере для поля `doc.chapter.p` явным образом задается, что оно
хранится не в атрибуте, а в дочернем элементе.

## Параметры конструкторов полей

Общими для всех типов полей являются следующие именованные параметры:

* `default` Значение поля по умолчанию. Подлежит валидации в момент инициализации
поля.
* `minOccurs` Минимальное число повторений поля. Необязательные поля имеют это
параметр равным нулю, по умолчанию это значение равно единице.
* `maxOccurs` Максимальное число повторений поля. Может принимать целые
значения от единицы и выше, или особое значение 'unbounded', означающее
неограниченное число повторений.
* `getter` Имя функции в составе класса, которая будет вызываться при доступе к
полю на чтение.
* `setter` Имя функции для записи в поле.
* `insert_after` Служит для управления порядком следования полей в схеме.
Задает имя поля, после которого следует вставить данное поле.
* `insert_before` Задает имя поля, перед которым следует вставить данное поле.
* `qualify` Если `True`, то поле квалифицируется в пространство имен, если
`False`, то нет. Простые и сложные элементы по умолчанию квалифицируются,
атрибуты -- нет.

## Класс `xml_orm.fields.BooleanField`

Автоматически преобразуются в булев тип при загрузке. При выгрузке в XML
принимают строковые значения "true" или "false".

## Класс `xml_orm.fields.CharField`

Строковый тип с ограничением максимальной длины, которое задается параметром
конструктора `max_length`.

## Класс `xml_orm.fields.FloatField`

Тип, соответствующий типу `float`.

## Класс `xml_orm.fields.IntegerField`

Тип, соответствующий типу `int`.

## Класс `xml_orm.fields.DecimalField`

Тип, соответствующий типу `decimal.Decimal`. Имеет параметры конструктора

`## Класс `xml_orm.fields.DateTimeField`

Хранит объект `datetime.datetime`, необязательный параметр конструктора
`format` задает формат для преобразования даты в строку и обратно. Формат
должен быть совместимым с `datetime.strptime()`, по умолчанию используется
стандартный формат ISO без таймзоны.

## Класс `xml_orm.fields.ComplexField`

Хранит сложные элементы, имеющие собственную схему. Класс для схемы передается
в первом, обязательном параметре конструктора. Класс схемы сложного
поля имеет свое пространство имен.

## Класс `xml_orm.fields.RawField`

Соответствуeт типу содержимого `xs:any`. Значением поля является объект
`etree.Element`, который, при преобразовании в XML или сохранении в файл, без
изменений переносится в результат сохранения.


# Класс-примесь `xml_orm.core.Zipped`

## Загрузка и сохранение архивов

В модуле `xml_orm.util` определен класс `Zipped`, который переопределяет стандартные
методы `load()` и `save()` так, что XML-объект загружается из архива в формате
Zip. Другие методы класса `xml_orm.core.Schema` работают без изменений. Для задания
имени файла в архиве, из которого производится загрузка, добавлен мета-параметр
`entry`.

    :::python
    from xml_orm.core import Schema
    from xml_orm.fields import *
    from xml_orm.util import Zipped
    
    class Article(Schema):
        uid = IntegerField(u'ИД')
        name = CharField(u'ИмяФайла', max_length=255)
        
        class Meta:
            root = u'Статья'

    class ZArticle(Zipped, Article):
        class Meta:
            entry = 'content.xml'
            
При загрузке новых объектов, метод `load()` может получать имя файла архива,
файло-подобный объект или байтовую строку с загруженным архивом. Если загрузка
была произведена из файла и его имя известно, то имя сохраняется в поле
`package`. В поле `basedir` при этом сохранится путь к пакету. 
Если в поле `package` было автоматически или иным образом записано
имя файла архива, сохранение методом `save()` будет произведено в файл с этим
именем. Если поле `basedir` не было присвоено вручную или при загрузке, в
качестве базовой будет выбрана текущая директория.


    :::python
    with ZArticle.load("archive.zip") as art:
        art.uid = 2
        # данные будут сохранены в файл "archive.zip"
        # в текущей директории
        
    with ZArticle.load(open("some.zip").read()) as art:
        # данные загружены из байтовой строки,
        # поэтому поле package не содержит имени файла
        art.package = "output.zip"
        art.basedir = r"c:\temp"
        
        # при выходе из контекста сохранение будет произведено
        # в архив "c:\temp\output.zip"
    
Если на момент вызова `save()` поле `package` так и не было присвоено, имя для
сохранения будет сформировано с помощью мета-параметра `package`. Параметр содержит
шаблон имени файла, при подстановке в который можно использовать сохраняемый
объект и его поля. В следующем примере сохраняемые архивы будут иметь имена
'article1.zip', 'article2.zip' и т.д., в соответствии с атрибутом `uid`.
    
    :::python
    class AutoZArticle(ZArticle):
        class Meta:
            entry = 'content.xml'
            package = 'article{self.uid}.zip'
            
    for i in range(10):
        art = Article(uid=i + 1,
                      author=u'Иван',
                      name=u'Влияние войны на мух')
        art.save()
            
## Чтение и запись файлов в архиве

К загруженному из архива или вновь созданному контейнеру можно добавить новый
файл. Для этого служит метод `write()`. Методу передается строка-имя файла в
архиве и его содержимое в виде байтовой строки. Если в архиве уже существует
файл с таким именем, он будет перезаписан.


    :::python
    art = Article(uid=i + 1,
                    author=u'Иван',
                    name=u'Влияние войны на мух')
    art.write('текст статьи.doc', open('текст статьи.doc', 'rb').read())
    art.save()
    
Метод `read()` позволяет считать из архива контейнера файл с заданным именем.
Результат метода -- байтовая строка с содержимым.

    :::python
    doc_content = art.read('текст статьи.doc')
    
Если в архиве отсутствует файл с данным именем, поднимается исключение
`KeyError`.

## Удаление файлов из архива

Метод `unlink(name)` позволяет удалить из контейнера файл с именем `name`. Если
файл уже отсутствует поднимается исключение `KeyError`. Изменения отразятся на
архиве после вызова метода `save()`.

## Список файлов в архиве

Метод `namelist()` возвращает список файлов, присутствующих в контейнере.
Список отражает последние изменения, сделанные в архиве методами `save()` и
`unlink()`.
    
## Свойство `raw_content`

`Zipped` контейнеры позволяют получить содержимое архива контейнера в виде
байтовой строки, для последующей передачи по сети или иного использования.
При вызове свойства автоматически проверяется валидность содержимого
контейнера.

    :::python
    open('new.zip', 'wb').write(art.raw_content)
